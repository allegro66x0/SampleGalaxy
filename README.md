# Sample Galaxy (Audio Sample Manager)

大量の音声サンプルを分析し、類似した音を銀河のように2次元マップ上に配置して可視化するツールです。
XO (XLN Audio) のような直感的なサンプル探索を、あなたのローカル環境で実現します。

## 主な機能
- **自動分析**: 指定したフォルダ内のWAVファイルをスキャンし、AI（機械学習）が音の特徴を分析します。
- **Galaxy View**: 似た音同士が近くに集まるように配置されます。色は音のタイプ（クラスター）を表します。
- **XO風ビジュアライゼーション**: 点が重ならないようグリッド状に美しく整列されます。
- **Tag Filtering**: サイドバーで楽器カテゴリ（KICK, SNARE, LOOPなど）ごとに表示/非表示を切り替えられます。
- **プレビュー**: 点をクリックするだけで即座に音を試聴できます。
- **DAW連携**: 気に入った音をドラッグ＆ドロップでStudio OneなどのDAWに直接貼り付けられます。
- **スマート分類**: キック、スネア、ループ、楽器（ギター/ピアノ）などをAIが自動判別し、色分けして表示します。

## アップデート情報 (New!)
- **分析パイプラインの高速化**: 重い「特徴量抽出」と軽い「配置計算」を分離しました。これにより、見た目の調整が高速に行えます。
- **密度調整 (--spread)**: 点の集まり具合（疎密）を自由に調整できるようになりました。
- **タグフィルター**: カテゴリごとの表示切り替えや、全選択/全解除ボタンを追加しました。

## インストール方法

Python 3.9以上が必要です。

1. 必要なライブラリをインストールします。
   ```bash
   pip install -r requirements.txt
   ```

## 使い方

効率的に使うために、処理が2段階に分かれています。

### 1. 特徴量の抽出 (extractor.py)
まず、音声ファイルから数値データ（特徴量）を取り出します。これには時間がかかりますが、**一度だけ**行えばOKです。

```bash
# 例: Eドライブのsoudsフォルダをスキャン
python extractor.py "E:\souds"
```
実行すると `raw_features.pkl` というファイルが生成されます。

### 2. 配置の計算 (sorter.py)
抽出されたデータを使って、画面上のどこに配置するかを計算します。これは高速（数秒〜数分）です。

```bash
python sorter.py
```

**見た目の調整:**
`--spread` オプションで、点の広がり具合（密度）を調整できます。数字が大きいほど、点と点の間隔が広くなります（デフォルト: 5.0）。

```bash
# より広々と配置したい場合
python sorter.py --spread 10.0
```

実行すると `database.json` が更新されます。

### 3. ビューアーの起動 (main.py)
アプリを起動してサンプルを探索しましょう。

```bash
python main.py
```

黒い背景のウィンドウ（Sample Galaxy）が立ち上がり、あなたのサンプルが美しく整列して表示されます。

### 操作方法
- **試聴**: 点を左クリックすると再生されます。
- **移動**: 背景をドラッグして視点を移動（パン）できます。
- **ズーム**: マウスホイールで拡大・縮小できます。
- **DAWへエクスポート**: 点をクリックして、そのままDAWのトラックやファイルエクスプローラーにドラッグ＆ドロップしてください。
- **サイドバー**:
    - **One-Shot Filter**: 短い音（One-Shot）だけを表示します。
    - **Tags**: 楽器カテゴリごとに表示をON/OFFできます。「All」「None」ボタンで一括切り替えも可能です。
- **右クリック**: 現在の音と似ている近傍のサンプルにランダムジャンプして連続再生します。

## トラブルシューティング
- **分析が終わらない**: ファイル数が数万を超えると `extractor.py` は時間がかかります。気長に待つか、フォルダを小分けにしてください。
- **エラーが出る**: パスに日本語が含まれている場合や、権限がないフォルダの場合にエラーになることがあります。
